---
title: "lxn/walk ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã« go build -race ã®ã‚¨ãƒ©ãƒ¼å›é¿"
emoji: "ğŸ˜€"
type: "tech"
topics: [Go]
published: false
published_at: 2017-08-27 14:27
---
[lxn/walk](https://github.com/lxn/walk) ã‚’ä½¿ã£ã¦ Windows ã§ GUI ãªã‚¢ãƒ©ãƒ¼ãƒ ã‚¢ãƒ—ãƒªã‚’ä½œã‚Šåˆã‚ãŸã€‚
race condition ãŒç™ºç”Ÿã—ãŸã®ã§ã€ `go build -race` ã‚’å®Ÿè¡Œã—ã¦ã¿ãŸã¨ã“ã‚ãƒ“ãƒ«ãƒ‰ã«å¤±æ•—ã€‚

```
$ go build -race
# github.com/hokorobi/MultiGoAlarm
C:\path\to\Go\pkg\tool\windows_amd64\link.exe: running gcc failed: exit status 1
D:/path/to/msys64/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/7.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: i386 architecture of input file `C:\Users\hokorobi\AppData\Local\Temp\go-link-505336639\000000.o' is incompatible with i386:x86-64 output
collect2.exe: error: ld returned 1 exit status

exit status 2
```

- lxn/walk ã‚„å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã‚ãªã„ã‚³ãƒ¼ãƒ‰ã ã¨ã‚¨ãƒ©ãƒ¼ã«ã¯ãªã‚‰ãªã„ã€‚
- lxn/walk/example ã§ã‚‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹

ã¨ã„ã†çŠ¶æ³ã ã£ãŸã®ã§ã€lxn/walk ã§ä½¿ç”¨ã™ã‚‹ rsrc.syso ãŒåŸå› ã§ã¯ãªã„ã‹ã¨ç›®æ˜Ÿã‚’ã¤ã‘ãŸã€‚

rsrc.syso ã®ç”Ÿæˆã«ä½¿ç”¨ã™ã‚‹ [akavel/rsrc](https://github.com/akavel/rsrc) ã‚’è¦‹ã«è¡Œãã¨ `-arch="386": architecture of output file - one of: 386, [EXPERIMENTAL: amd64]` ã¨ã„ã†è¨˜è¼‰ã‚’è¦‹ã¤ã‘ãŸã€‚
rsrc ã‚’æ›´æ–°ã—ã¦ -arch="amd64" ã‚’ã¤ã‘ã¦ rsrc.syso ã‚’ç”Ÿæˆã€‚
å†åº¦ã® `go build -race` ã§ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿãªã—ã€‚
akavel/rsrc ã« EXPERIMENTAL ã¨ã‚ã‚‹ã®ã§ã€Race Detector ãŒã¡ã‚ƒã‚“ã¨æ©Ÿèƒ½ã™ã‚‹ã‹ã¯ä¸æ˜ã€‚

rsrc.syso ã§ãªã manifest ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãå ´åˆã¯å•é¡Œãªã„ã®ã ã¨æ€ã†ï¼ˆæœªæ¤œè¨¼ï¼‰

