---
title: "Vim æœ¬ä½“ã®è‡ªå‹•è£œå®Œè¨­å®šè©¦ç”¨"
emoji: "ğŸ¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Vim"]
published: true
---

:::message
ã“ã®è¨˜äº‹ã¯ [Vimé§…ä¼](https://vim-jp.org/ekiden/) 2025-09-29 ã®è¨˜äº‹ã§ã™ã€‚
:::

Vim æœ¬ä½“ã®è‡ªå‹•è£œå®ŒãŒå……å®Ÿã—ã¦ããŸã®ã§ [VimComplete ãŒ Deprecate ã«ãªã‚Šã¾ã—ãŸã€‚](https://github.com/girishji/vimcomplete/commit/e60622ed084892321b96721edaa0a76c973afce8)
æœ¬ä½“ã®è‡ªå‹•è£œå®Œã«ç§»è¡Œã™ã¹ãä»¥ä¸‹ã®ã‚ˆã†ãªè¨­å®šã§è©¦ã—ã¦ã„ã¾ã™ã€‚
~~ã¾ã æœ¬æ ¼ä½¿ç”¨ã¯è¾›ã„ã‹ãªã€‚
ã§ã‚‚ã€~~ ã¾ã é€²åŒ–ã—ãã†ãªã®ãŒæ¥½ã—ã¿ã§ã™ã€‚

- 2025-09-29 æ›´æ–°
  - yegappan/lsp ã§ã®è‡ªå‹•è£œå®Œã¯ã‚„ã‚ã‚‹ã‚ˆã†ã«å¤‰æ›´ã€‚
- 2025-10-05 æ›´æ–°
  - vsnip ã‚’æœ¬ä½“ã®è£œå®Œå€™è£œã«è¿½åŠ ã€‚
- 2025-10-06 æ›´æ–°
  - [vsnip ã«è£œå®Œé–¢æ•°ã‚’ merge ã—ã¦ã‚‚ã‚‰ã£ãŸ](https://github.com/hrsh7th/vim-vsnip/pull/283) ã®ã§å¤‰æ›´ã€‚
  - vim-submode ã‚’ä½¿ã‚ãšã«åŒæ§˜ã®å‹•ä½œã‚’ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã€‚
  - LSP ã®å‰²ã‚Šå½“ã¦ã‚’ filetype æŒ‡å®šæ™‚ã«å¤‰æ›´ã€‚

## ç’°å¢ƒ

- Windows11
- gVim 9.1.1818

## è‰¯ã„ã¨ã“ã‚

- è£œå®Œãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒä¸è¦

## ã‚¤ãƒã‚¤ãƒãªã¨ã“ã‚

~~è‡ªåˆ†ãŒä½¿ãˆã“ãªã›ã¦ã„ãªã„ã ã‘ã®å¯èƒ½æ€§ã‚‚ã‚ã‚Šã€‚~~
vsnip ã‚‚å•é¡Œãªã•ãã†ãªã®ã§å¸¸ç”¨ã§ããã†ã€‚

- ~~ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®è£œå®Œå€™è£œã‚’é¸æŠã—ã¦ã‚‚æŒ¿å…¥ã¯ã•ã‚Œãªã„ã¿ãŸã„ãªã®ã§ `<C-l>` ã§æŒ¿å…¥ã—ã¦ã„ã‚‹ã€‚~~
  ~~ã“ã‚Œã«æ…£ã‚Œãªã„ã®ã§ VimComplete ã«æˆ»ã‚Šãã†ã€‚~~
  ~~lsp ã®è‡ªå‹•è£œå®Œã¯è£œå®Œå€™è£œã®é¸æŠã§æŒ¿å…¥ã•ã‚Œã‚‹ã®ã§ã¾ã™ã¾ã™â€¦ã€‚~~
  `<C-n>`, `<C-p>` ã« `<Down>`, `<Up>` ã‚’å‰²ã‚Šå½“ã¦ã¦ã„ãŸã‹ã‚‰ã ã£ãŸã€‚
- ~~lsp ã®è£œå®Œã¯ãªã‚“ã ã‹æ°—ã«ãªã‚‹å‹•ãã‚’ã™ã‚‹ã€‚~~
  - ~~lsp ã‚’ä½¿ã† filetype ã§ã¯ , ( ãªã©ã§ lexima ãŒå‹•ã‹ãªã„å ´åˆãŒã‚ã‚‹ã€‚~~
  - ~~vsnip ã®å±•é–‹ã®éš›ã«å…¥åŠ›ã—ãŸæ–‡å­—åˆ—ãŒæ¶ˆã•ã‚Œãšæ®‹ã‚‹ï¼ˆå ´åˆãŒã‚ã‚‹ï¼Ÿï¼‰~~
    yegappan/lsp ã®è£œå®Œã§ãªãæœ¬ä½“ã®è£œå®Œã§ omnifunc ã‚’ä½¿ã†ã‚ˆã†ã«ã—ãŸã‚‰è‰¯ã•ãã†ã€‚
- ~~lsp ã‚’ä½¿ã‚ãªã„ filetype ã§ã¯ snippet ãŒè£œå®Œå€™è£œã«è¡¨ç¤ºã•ã‚Œãªã„ã€‚~~
  ~~vsnip ã®å€™è£œã‚’è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã« complete ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«æ¸¡ã™é–¢æ•°ã‚’ Gemini ã«æ›¸ã„ã¦ã‚‚ã‚‰ã£ãŸã€‚~~
  [vsnip ã«è£œå®Œé–¢æ•°ã‚’ merge ã—ã¦ã‚‚ã‚‰ã£ãŸ](https://github.com/hrsh7th/vim-vsnip/pull/283)
- è¨­å®šã«ã‚ˆã£ã¦ã¯ãƒã‚°ã£ã½ã„å‹•ä½œãŒã¾ã ã‚ã‚‹ã€‚
  - completefuzzycolletct=keyword ã¨ã—ãŸã‚‰æ„å›³ã—ãªã„æ–‡å­—åˆ—ã®æŒ¿å…¥ãŒã•ã‚ŒãŸã£ã½ã„ [9.1.1782]
- ~~VimComplete ã«æ¯”ã¹ã‚‹ã¨é…ãæ„Ÿã˜ã‚‹ã€‚åé›†ã™ã‚‹å€™è£œãŒå¤šããªã£ã¦ã„ã‚‹è¨­å®šãªã®ã‹ã‚‚ã€‚~~
  æ°—ã®ã›ã„ã£ã½ã„ï¼Ÿ

## ä½¿ç”¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

ãã‚Œãã‚Œã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ãªã©ã¯æ›¸ãã¾ã›ã‚“ã€‚ä½¿ãˆã‚‹çŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹ã‚‚ã®ã¨ã—ã¦ä»¥ä¸‹è¨˜è¿°ã—ã¾ã™ã€‚

- [yegappan/lsp](https://github.com/yegappan/lsp)
- [hrsh7th/vim-vsnip](https://github.com/hrsh7th/vim-vsnip) : snippet
- [hrsh7th/vim-vsnip-integ](https://github.com/hrsh7th/vim-vsnip-integ) : vsnip ã‚’ lsp ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ã€‚
- [rafamadriz/friendly-snippets](https://github.com/rafamadriz/friendly-snippets) : vsnip ã§ä½¿ã† snippet é›†ã€‚è‡ªåˆ†ã«åˆã†ã‹ã¯ã‚ã‹ã‚‰ãªã„ã€‚ã¨ã‚Šã‚ãˆãšã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã ã‘ã€‚

## ä½¿ç”¨lsp

- [Deno](https://deno.com)
- [Gopls](https://go.dev/gopls/)
- [Taplo](https://taplo.tamasfe.dev/)

## è‡ªå‹•è£œå®Œã®è¨­å®š

- è‡ªå‹•è£œå®Œã®é–‹å§‹ã¯ 0.2 ç§’å¾Œã«
- `complete` ã®å¤‰æ›´
  - t å‰Šé™¤: è‡ªåˆ†ã®ç’°å¢ƒã§ã¯ã‚¿ã‚°è£œå®Œã§å›ºã¾ã‚‹ã‚ˆã†ã ã£ãŸã®ã§
  - b^5: ã€Œãƒãƒƒãƒ•ã‚¡ãƒªã‚¹ãƒˆå†…ã®ã€ç¾åœ¨èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹åˆ¥ã®ãƒãƒƒãƒ•ã‚¡ã‹ã‚‰æ¤œç´¢ã€ã¨ã„ã†ã“ã¨ãªã®ã§é–¢ä¿‚ãªã„ã‚‚ã®ãŒã‚ã‚Šãã†ã ã‹ã‚‰ãƒãƒƒãƒæ•°ã‚’æ¸›ã‚‰ã—ã¦ã¿ã‚‹ã€‚ãƒ˜ãƒ«ãƒ—ã‚’é–‹ã„ã¦ã„ã‚‹ã¨æ—¥æœ¬èªãŒã‚ã‚“ã•ã‹å‡ºã¦ãã‚‹ã¿ãŸã„ã€‚
  - k è¿½åŠ : plantuml, autohotkey ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã§ dictionary ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã®ã§ã€ãã“ã‹ã‚‰è£œå®Œã€‚
  - o è¿½åŠ : lsp ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã« omnifunc ã§è£œå®Œã€‚
  - Fvsnip#completefunc è¿½åŠ : vim-vsnip ã§æä¾›ã•ã‚Œã‚‹è£œå®Œé–¢æ•° `vsnip#completefunc` ã§è£œå®Œã€‚

```Vim:vimrc
set autocomplete
set autocompletedelay=200
set complete=.,k,w,b^5,u,i,o,Fvsnip#completefunc
set completefuzzycollect=keyword
set completeopt-=preview completeopt+=menuone completeopt+=fuzzy completeopt+=popup

" è£œå®Œå€™è£œãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãŸã‚‰é¸æŠã—ã¦æŒ¿å…¥ã€‚è£œå®Œå€™è£œãŒå‡ºã¦ã„ãªã„ã¨ãã®å‹•ä½œã¯ãŠå¥½ã¿ã§ã€‚
inoremap <expr> <C-n> pumvisible() ? '<C-n>' : '<Cmd>normal! gj<CR>'
inoremap <expr> <C-p> pumvisible() ? '<C-p>' : '<Cmd>normal! gk<CR>'
```

## filetype ã”ã¨ã®è¨­å®š

### autohotkey

https://github.com/fincs/SciTE4AutoHotkey/ ã® source/ahk2.standard.api ã¨ source/ahk.keys.api ã‚’çµåˆã—ãŸã‚‚ã®ã‚’ dictionary ã¸ã€‚
https://github.com/AutoHotkey/AutoHotkeyDocs/tree/v2 ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ syntaxgen\CreateAhk2.ahk, syntaxgen\CreateKeys.ahk ã§å†ç”Ÿæˆã—ã¦ã¿ãŸã‘ã©å¤‰ã‚ã£ã¦ã„ãªã‹ã£ãŸã€‚

```Vim:~/_vim/after/ftplugin/autohotkey.vim
setlocal dictionary=~/path/to/autohotkey.txt
```

### plantuml

plantuml.jar -language ã§å‡ºåŠ›ã—ãŸå†…å®¹ã‚’ dictionary ã¸

```Vim:~/_vim/after/ftplugin/plantuml.vim
setlocal dictionary=~/path/to/plantuml.txt
```

## yegappan/lsp ã®è¨­å®š

lsp ã‚’ä½¿ã†å ´åˆã‚‚ yegappan/lsp ã®è‡ªå‹•è£œå®Œã¯ä½¿ã‚ãªã„ã€‚vsnip ã¯ä½¿ãˆã‚‹ã‚ˆã†ã«è¨­å®šã€‚

```Vim:lsp.vim
function s:lspSet() abort
  let lspOpts = #{
        \ autoComplete: v:false,
        \ autoPopulateDiags: v:false,
        \ condensedCompletionMenu: v:true,
        \ completionKinds: v:true,
        \ snippetSupport: v:true,
        \ vsnipSupport: v:true,
        \}
  call LspOptionsSet(lspOpts)

  let lspServers = [
        \ #{name: 'deno',
        \   filetype: ['typescript'],
        \   path: 'deno',
        \   args: ['lsp'],
        \ },
        \ #{name: 'gopls',
        \   filetype: 'go',
        \   path: fnamemodify('~/bin/gopls.exe', ':p')->substitute('\', '/', 'g'),
        \   args: ['serve'],
        \   syncInit: v:true,
        \ },
        \ #{name: 'taplo',
        \   filetype: 'toml',
        \   path: 'taplo',
        \   args: ['lsp', 'stdio'],
        \ },
        \]
  call LspAddServer(lspServers)
endfunction
autocmd vimrc User LspSetup call s:lspSet()

function s:LspHas(feature)
  return !lsp#buffer#CurbufGetServer(a:feature)->empty()
endfunction

function s:lspKeymap() abort
  if s:LspHas("hover")
    setl keywordprg=:LspHover
  endif
  if s:LspHas("declaration")
    nnoremap <buffer> gd :LspGotoDeclaration<CR>
    nnoremap <buffer> gD :LspPeekDeclaration<CR>
  endif
  nnoremap <buffer> <Space>al <Cmd>LspDiagShow<CR>
  nnoremap <buffer> <C-]> <Cmd>LspGotoDefinition<CR>
  nnoremap <buffer> <Space>ar <Cmd>LspRename<CR>
  nnoremap <buffer> <Space>aR <Cmd>LspReferences<CR>

  " like submode
  nnoremap <Plug>(lsp) <Nop>
  nnoremap <Plug>(lsp)p <Cmd>LspDiagPrev<CR><Plug>(lsp)
  nnoremap <Plug>(lsp)n <Cmd>LspDiagNext<CR><Plug>(lsp)
  nnoremap <Space>an <Cmd>LspDiagNext<CR><Plug>(lsp)
  nnoremap <Space>ap <Cmd>LspDiagPrev<CR><Plug>(lsp)
  nnoremap <Space>aj :echo 'Use Space an'<CR>
  nnoremap <Space>ak :echo 'Use Space ap'<CR>
endfunction
autocmd vimrc User LspAttached call s:lspKeymap()
```

LSP ã®å‰²ã‚Šå½“ã¦ã¯ filetype æŒ‡å®šæ™‚ã€‚
LSP ã®ãƒ‘ã‚¹ã¯ãã‚Œãã‚Œã¸å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

### go

```Vim:~/_vim/after/ftplugin/go.vim
call LspAddServer([
      \ #{name: 'gopls',
      \   filetype: 'go',
      \   path: fnamemodify('~/bin/gopls.exe', ':p')->substitute('\', '/', 'g'),
      \   args: ['serve'],
      \   syncInit: v:true,
      \ },
      \])
```

### toml

```Vim:~/_vim/after/ftplugin/toml.vim
call LspAddServer([
      \ #{name: 'taplo',
      \   filetype: 'toml',
      \   path: 'taplo',
      \   args: ['lsp', 'stdio'],
      \ },
      \])
```

### typescript

```Vim:~/_vim/after/ftplugin/typescript.vim
call LspAddServer([
      \ #{name: 'deno',
      \   filetype: ['typescript'],
      \   path: 'deno',
      \   args: ['lsp'],
      \ },
      \])
```

## vsnip ã®è¨­å®š

```Vim:vsnip.vim
imap <silent><expr> <Tab>
      \ pumvisible() ? '<Down>' :
      \ vsnip#jumpable(1)  ? '<Plug>(vsnip-jump-next)' :
      \ '<Tab>'
smap <silent><expr> <Tab>  vsnip#jumpable(1)  ? '<Plug>(vsnip-jump-next)' : '<Tab>'
imap <silent><expr> <S-Tab>
      \ pumvisible() ? '<Up>' :
      \ vsnip#jumpable(-1)  ? '<Plug>(vsnip-jump-prev)' :
      \ '<C-h>'
smap <expr> <S-Tab> vsnip#jumpable(-1) ? '<Plug>(vsnip-jump-prev)' : '<S-Tab>'
imap <silent><expr> <C-j>
      \ pumvisible() ? '<C-n>' :
      \ '<C-j>'
imap <silent><expr> <C-k>
      \ pumvisible() ? '<C-p>' :
      \ '<Cmd>normal! D<CR>'
" vsnip ã®å±•é–‹å€™è£œã‚’é¸æŠã—ã¦ã„ã‚‹çŠ¶æ…‹ãªã‚‰ <C-y> ã§å±•é–‹ã•ã‚Œã‚‹
" <C-l> ãŒæŠ¼ã—ã‚„ã™ã„ã¨æ„Ÿã˜ã¦ã„ã‚‹ã®ã§ã“ã¡ã‚‰ã§
imap <silent><expr> <C-l>
      \ pumvisible() ? '<C-y>' :
      \ vsnip#expandable() ? '<Plug>(vsnip-expand)' :
      \ vsnip#jumpable(1) ? '<Plug>(vsnip-jump-next)' :
      \ ''

" å„ç’°å¢ƒã«å¾“ã£ã¦å¤‰æ›´
let g:vsnip_snippet_dirs = [
      \ expand('~/vimfiles/plug/vsnip'),
      \ expand('~/_vim/path/to/friendly-snippets/snippets'),
      \]
```
