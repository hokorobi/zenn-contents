---
title: "Vim ä¸Šã§ã® git ä»•è‰"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Vim", "Git"]
published: true
---

Vim ä¸Šã§ git ã‚’ä½¿ã†æ™‚ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã‹ã‚­ãƒ¼ãƒãƒƒãƒ—ã¨ã‹ãƒ•ãƒ­ãƒ¼ã¨ã‹ã€‚

## ä½¿ç”¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

- [lambdalisue/gina.vim](https://github.com/lambdalisue/gina.vim)
- ~~[kuuote/gina-preview.vim](https://github.com/kuuote/gina-preview.vim)~~
- [lambdalisue/gin.vim](https://github.com/lambdalisue/gin.vim)
- [cohama/agit.vim](https://github.com/cohama/agit.vim) ã«ã¡ã‚‡ã£ã¨æ‰‹ã‚’åŠ ãˆãŸ [hokorobi/agit.vim](https://github.com/hokorobi/agit.vim)
  - fixup, switch, restore ãªã©ã‚’è¿½åŠ 
- [voldikss/vim-floaterm](https://github.com/voldikss/vim-floaterm)
- [ctrlpvim/ctrlp.vim](https://github.com/ctrlpvim/ctrlp.vim)
- [mattn/ctrlp-launcher](https://github.com/mattn/ctrlp-launcher)
- [christoomey/ctrlp-generic](https://github.com/christoomey/ctrlp-generic)
- [Shougo/ddu.vim](https://github.com/Shougo/ddu.vim)
- [peacock0803sz/ddu-source-git_stash](https://github.com/peacock0803sz/ddu-source-git_stash)

### ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®š

#### lambdalisue/gin.vim

```vim
" !git ã®å‹•ä½œã«æ”¯éšœã‚’ããŸã™ãŸã‚ç’°å¢ƒå¤‰æ•° GIT_EDITOR ã®æ›¸ãæ›ãˆã‚’ç¦æ­¢
let g:gin_proxy_disable_editor = v:true
```


## ã‚­ãƒ¼ãƒãƒƒãƒ—

`nnoremap qt <Cmd>tabclose<CR>`: ã‚¿ãƒ–ã§é–‹ã„ãŸã‚‰ã“ã‚Œã§é–‰ã˜ã‚‹ã€‚


### status

- `nnoremap <Space>gs <Cmd>!git status -v<CR>`: -v ã§ git add ã—ãŸå†…å®¹ã‚’ç¢ºèªã€‚
- ~~`nnoremap <Space>gS <Cmd>GinaPreview<CR>`: [kuuote/gina-preview.vim](https://github.com/kuuote/gina-preview.vim) ã§ç”»é¢åˆ†å‰²è¡¨ç¤º~~ â†“ã¸å¤‰æ›´ã€‚
- `nnoremap <Space>gS <Cmd>GinStatus<CR>`: gin.vim ã§ status è¡¨ç¤ºã€‚`<<` `>>` ãªã©ã§ add ã‚„å–æ¶ˆã€‚

### log

- ~~`nnoremap <Space>gl <Cmd>GinLog ++opener=tabnew --all --graph --max-count=100 --oneline --decorate<CR>`: ãƒ­ã‚°ã¨ã‚°ãƒ©ãƒ•ã‚’ä¸€è¡Œè¡¨ç¤ºã€‚~~ â†“ã¸å¤‰æ›´ã€‚
- `nnoremap <Space>Agit<CR>`: ãƒ­ã‚°ã¨ã‚°ãƒ©ãƒ•ã‚’ä¸€è¡Œè¡¨ç¤ºã€‚ãã“ã‹ã‚‰è‰²ã€…ã¨ git ã®æ“ä½œã€‚
- `nnoremap <Space>gL <Cmd>GinLog --all --graph --max-count=100 --oneline --decorate<CR>`: ãƒ­ã‚°ã¨ã‚°ãƒ©ãƒ•ã¨å·®åˆ†ã‚’è¡¨ç¤ºã€‚
- ~~`nnoremap <Space>gg  :Gina log -p -G""<Left>`: æ­£è¦è¡¨ç¾ãŒå¤‰æ›´ã«å«ã¾ã‚Œã‚‹ã‚³ãƒŸãƒƒãƒˆã‚’è¡¨ç¤ºã€‚~~ â†“ã«å¤‰æ›´ã€‚ã†ã¾ãå‹•ã‹ãªã‹ã£ãŸã€‚
- `nnoremap <Space>gg :FloatermNew git log -p -G`: æ­£è¦è¡¨ç¾ãŒå¤‰æ›´ã«å«ã¾ã‚Œã‚‹ã‚³ãƒŸãƒƒãƒˆã‚’è¡¨ç¤ºã€‚


### add

- `nnoremap <Space>gai <Cmd>!git add --interactive<CR>`: ãƒ•ã‚¡ã‚¤ãƒ«å˜ä½ã§ã® add ã¯ã“ã¡ã‚‰ã‚’ä½¿ã†ã€‚
- `nnoremap <Space>gad :!git add --patch<Space>`: å¤‰æ›´ç®‡æ‰€å˜ä½ã§ã® add ã¯ã“ã¡ã‚‰ã‚’ä½¿ã†ã€‚ç¾åœ¨ã®ãƒãƒƒãƒ•ã‚¡ã ã‘ã‚’å¯¾è±¡ã«ã™ã‚‹ãªã‚‰ % ã‚’å…¥åŠ›ã—ã¦ Enterã€‚ e ã®ã¨ãã«ç·¨é›†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹ã¨ãã¯ `:cq` ã‚’ä½¿ã†ã€‚
- `nnoremap <Space>gaD <Cmd>GinPatch ++opener=tabnew %<CR>`: gin.vim ã§å¤‰æ›´ç®‡æ‰€å˜ä½ã§ã® add ãªã©ã€‚å¤‰æ›´ç®‡æ‰€ã«ã•ã‚‰ã«å¤‰æ›´ã‚’åŠ ãˆã‚‹å ´åˆã«ã‚ˆã‚Šä½¿ã„ã‚„ã™ã„ã‹ãªã€‚
- `nnoremap <Space>gu  <Cmd>silent !git add --update<CR>`: å¤‰æ›´ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã™ã¹ã¦ addã€‚æœ€è¿‘ `git commit --all -v` ã‚’ä½¿ãˆã°ã“ã‚Œã¯ã„ã‚‰ãªã•ãã†ã¨æ°—ã¥ã„ãŸã€‚
- `nnoremap <Space>gS <Cmd>GinStatus<CR>`: ã‚³ãƒŸãƒƒãƒˆã«å«ã‚ã‚‹å¤‰æ›´ã‚’é¸æŠ


### commit

- `nnoremap <Space>gn  :!git commit --all -v -m ""<Left>`: ä¸€è¡Œã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ã¹ã¦ã®å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã€‚`-m ""` ã‚’å‰Šé™¤ã—ã¦è©³ç´°ã«ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›¸ãæ™‚ã‚ˆã†ã« `-v` ã‚‚å…¥ã‚Œã¦ã„ã‚‹ã‘ã©ã€ã‚„ã£ã±ã‚Šã„ã‚‰ãªã„ã‹ãªã€‚
- `nnoremap <Space>gN  <Cmd>!git commit --all -v<CR>`: è©³ç´°ã«ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›¸ãæ™‚ã¯ã“ã¡ã‚‰ã€‚
- `nnoremap <Space>gc  <Cmd>!git commit -v<CR>`: `git add` ãŒçµ‚ã‚ã£ãŸã‚‰ã“ã¡ã‚‰ã€‚
- `nnoremap <Space>gam <Cmd>!git commit --amend<CR>`: `git add` å¾Œã«ç›´å‰ã®ã‚³ãƒŸãƒƒãƒˆã¸æ··ãœã‚‹ã€‚


### push

- `nnoremap <Space>gp :!git push origin @`


### diff

- `nnoremap <Space>gd <Cmd>!git diff HEAD<CR>`: `git add` å‰ã«å¤‰æ›´ç®‡æ‰€ç¢ºèªã€‚
- `nnoremap <Space>gD <Cmd>!git diff HEAD %<CR>`: `git add` ã‚«ãƒ¬ãƒ³ãƒˆãƒãƒƒãƒ•ã‚¡ã®å¤‰æ›´ç®‡æ‰€ç¢ºèªã€‚
- `nnoremap <Space>g<M-d> <Cmd>GinDiff ++opener=tabnew<CR>`: ãŸãã•ã‚“å¤‰æ›´ã—ã¦ã„ãŸã‚‰ãƒãƒƒãƒ•ã‚¡ä¸Šã§ç¢ºèªã‚’ã™ã‚‹ãŸã‚ã«ã“ã£ã¡ã‚’ä½¿ã†ã“ã¨ã‚‚ã€‚


### branch

- `nnoremap <Space>gbb <Cmd>call systemlist('git branch')->CtrlPGeneric('CtrlPGenericGitSwitch')<CR>`: CtrlP ã§ãƒ–ãƒ©ãƒ³ãƒã‚’é¸æŠã—ã¦ switchã€‚
  ```vim
  function! CtrlPGenericGitSwitch(selected_value) abort
    call substitute(a:selected_value, '\s*\*\?\s*\|\s\+', '', 'g')
    \  ->printf('!git switch %s')
    \  ->execute()
  endfunction
  ```
- `nnoremap <Space>gbB <Cmd>call ddu#start(#{sources: [#{name: 'git_branch'}]})<CR>`: ddu.vim ã§ãƒ–ãƒ©ãƒ³ãƒã‚’é¸æŠã—ã¦è‰²ã€…ã€‚
- `nnoremap <Space>gbc :!git switch -c<Space>`: ãƒ–ãƒ©ãƒ³ãƒä½œæˆã€‚
- `nnoremap <Space>gbr :!git branch -m temp`: ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒåã‚’å¤‰æ›´ã€‚temp ã‹ã‚‰å¥½ããªåå‰ã«å¤‰æ›´ã™ã‚‹ã€‚
- `nnoremap <Space>gbm :!git branch -m temp`: ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒåã‚’ä»®åã«å¤‰æ›´ã€‚ `<Space>gbr` ã¨åŒã˜ã€‚m ã¨ r ã‚’æ‚©ã‚€æ™‚ãŒã‚ã‚‹ã®ã§ã€‚
- `nnoremap <Space>gbw :!git switch -`: ç›´å‰ã®ãƒ–ãƒ©ãƒ³ãƒã«åˆ‡ã‚Šæ›¿ãˆã€‚
- `nnoremap <Space>gbc :!git switch -c<Space>`: ãƒ–ãƒ©ãƒ³ãƒåã‚’å…¥åŠ›ã—ã¦ãƒ–ãƒ©ãƒ³ãƒä½œæˆã€‚


### others

- `nnoremap <Space>gy :GinBrowse ++yank=+ -n<CR>`: Github ã® URL ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã‚³ãƒ”ãƒ¼ã€‚
- `xnoremap <Space>gy :GinBrowse ++yank=+ -n<CR>`: é¸æŠè¡Œã® Github ã® URL ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã‚³ãƒ”ãƒ¼ã€‚
- `nnoremap <Space>go :GinBrowse<CR>`: Github ã® URL ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã€‚
- `xnoremap <Space>go :GinBrowse<CR>`: é¸æŠè¡Œã® Github ã® URL ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã€‚
- `nnoremap <Space>oG :GinBrowse<CR>`: Github ã® URL ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã€‚
- `xnoremap <Space>oG :GinBrowse<CR>`: é¸æŠè¡Œã® Github ã® URL ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã€‚
- ~~nnoremap <Space>gbo * :GinEdit ++opener=vsplit  %<Left><Left>`: ã‚³ãƒŸãƒƒãƒˆã‚„ãƒ–ãƒ©ãƒ³ãƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤ºã€‚ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ã‚„ãƒ–ãƒ©ãƒ³ãƒåã‚’å…¥åŠ›ã™ã‚‹ä½ç½®ã« <Left> ã§ã‚«ãƒ¼ã‚½ãƒ«ç§»å‹•ã€‚~~ â†“ã¸å¤‰æ›´ã€‚
- `nnoremap <Space>gbo * <Cmd>call systemlist('git log --date=short --pretty=format:"%h %cd %s"')  ->CtrlPGeneric('CtrlPGenericPassGitHash2GinEdit')<CR>`: ã‚³ãƒŸãƒƒãƒˆã‚’ CtrlP ã§é¸æŠã€ãã®ã‚³ãƒŸãƒƒãƒˆæ™‚ç‚¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ CtrlP ã§é¸æŠã—ã¦ gin.vim ã§é–‹ãã€‚
  ```vim
  function! CtrlPGenericPassGitHash2GinEdit(selected_value) abort
    const s:hash = matchstr(a:selected_value, '\w\+')
    call systemlist($'git ls-tree -r --name-only {s:hash}')
    \  ->CtrlPGeneric('CtrlPGenericGinEditHash')
  endfunction
  function! CtrlPGenericGinEditHash(selected_value) abort
    execute $':GinEdit ++opener=vsplit {s:hash} {a:selected_value}'
  endfunction
  ```
- `nnoremap <Space>gbl <Cmd>Gina blame<CR>`: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãª `git blame`ã€‚
- `nnoremap <Space>gh :!git cherry-pick<Space>`: cherry-pick
- `nnoremap <Space>gt <Cmd>call ddu#start(#{sources: [#{name: 'git_stash'}]})<CR>`: ddu.vim ã§ stash ã‚’æ“ä½œã€‚
- `nnoremap <Space>gr <Cmd>CtrlPLauncher git-restore<CR>`: CtrlP ã§ restore æ“ä½œã‚’é¸æŠã€‚
  ```:.ctrlp-launcher-git-restore
  ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã‚’å–ã‚Šæ¶ˆã™	!git restore -staged .
  ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã‚’å–ã‚Šæ¶ˆã—ã¦ãƒ¯ãƒ¼ã‚¯ãƒ„ãƒªãƒ¼ã‚’HEADã«æˆ»ã™	!git restore -staged - worktree .
  ãƒ¯ãƒ¼ã‚¯ãƒ„ãƒªãƒ¼ã‚’HEADã«æˆ»ã™	!git restore .
  tempãƒ–ãƒ©ãƒ³ãƒã®å†…å®¹ã‚’ãƒ¯ãƒ¼ã‚¯ãƒ„ãƒªãƒ¼ã«åæ˜ ã™ã‚‹	!git restore --source=temp .
- `nnoremap <Space>gf <Cmd>CtrlPLauncher git<CR>`: CtrlP ã§ git æ“ä½œã‚’é¸æŠã€‚ä¸­èº«ã¯æ¤œè¨ä¸­ã€‚
  ```:.ctrlp-launcher-git-restore
  git log all files	execute('GinBuffer log --all --graph -100 --oneline --decorate')
  git log all files patch	execute('GinBuffer log --all --patch --graph -100')
  git log CtrlP file	call ctrlp#filter#do('CtrlP', #{filtermethods: ['printf', 'execute'], methodsargs: #{printf: ['GinBuffer log ++opener=tabnew --all --graph -100 --oneline --decorate %s']}})
  git show select log	call CtrlpGenericGitShow()
  ```

#### master ã«é–“é•ã£ã¦ã‚³ãƒŸãƒƒãƒˆã—ãŸæ™‚ã«å¯¾å‡¦

1. `nnoremap <Space>gbr :!git branch -m temp`: ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒåã‚’ä»®åã«å¤‰æ›´ã€‚
2. `nnoremap <Space>g-  :!git switch -c master HEAD~`: èµ·ç‚¹ã«ã™ã‚‹ã‚³ãƒŸãƒƒãƒˆã«ãƒ–ãƒ©ãƒ³ãƒä½œæˆã€‚
3. `nnoremap <Space>gr  :!git restore --source=temp .`: `restore` å¾Œã« `git commit -p` ã§éƒ¨åˆ†çš„ã« `add` ã—ã¦ `commit` ã€‚
4. `git commit -p` ã§éƒ¨åˆ†çš„ã« `add` ã—ã¦ `commit` ã€‚
5. `nnoremap <Space>gbd :!git branch -D temp`: ä»®åã®ãƒ–ãƒ©ãƒ³ãƒã‚’å‰Šé™¤ã€‚


## ãƒ•ãƒ­ãƒ¼

### ç·¨é›† â†’ [add â†’] commit

![30398c5525bf4f.png](/images/30398c5525bf4f.png)

