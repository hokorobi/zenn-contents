---
title: "Paper Plane xUI ã§ peco ã‚’ä½¿ã£ã¦ãƒ•ã‚©ãƒ«ãƒ€å±¥æ­´ã‚’ãŸã©ã‚‹"
emoji: "ğŸ˜€"
type: "tech"
topics: [Peco,PPx]
published: false
published_at: 2016-09-17 20:35
---

åŸºæœ¬éƒ¨åˆ†ã¯ [Paper Plane xUI ã§ peco ã‚’ä½¿ã£ã¦ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ - Qiita](http://qiita.com/hokorobi/items/4e6d5cc76be48496d2f8) ã¨ãŠãªã˜ã€‚

```js:historypeco.js9
//!*script
// ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å±¥æ­´ã‚’pecoã§é¸æŠã—ã¦åˆ‡ã‚Šæ›¿ãˆ
// PPx 1.50+3 x64 + Script Module R16

if (PPx.Extract("%h1)") == "") PPx.Quit(-1);

var Fso = new ActiveXObject('Scripting.FileSystemObject');

var file = getListFile();
PPx.Execute('%Obsq *launch peco < ' + file + ' | iconv -f UTF-8 -t CP932 | clip');

PPx.Execute('*ppc -r ' + PPx.Clipboard);
Fso.DeleteFile(file);

function getListFile() {
    // å±¥æ­´ã‚’å–å¾—
    var dirs = [];
    for (var i = 1; PPx.Extract("%h" + i) != ""; i++) {
        dirs.push(PPx.Extract("%h" + i));
    }
    // é‡è¤‡å‰Šé™¤
    var uniqdirs = dirs.filter(function (x, i, self) {
        return self.indexOf(x) === i;
    });

    // ãƒ•ã‚¡ã‚¤ãƒ« UTF-8 ã§å‡ºåŠ›
    var posFirst = 0;
    var posSkipBOM = 3;
    var adWriteLine = 1; // è¡ŒåŒºåˆ‡ã‚Šæ–‡å­—ï¼ˆæ”¹è¡Œï¼‰ã‚‚å…¥åŠ›
    var adSaveCreateOverWrite = 2;
    var adTypeBinary = 1;
    var adTypeText = 2;

    var ado = new ActiveXObject('ADODB.Stream');
    ado.Type = adTypeText;
    ado.Charset = 'UTF-8';
    ado.Open();

    for (var i = 0; i < uniqdirs.length; ++i) {
        ado.writeText(uniqdirs[i], adWriteLine);
    }

    ado.Position = posFirst; // ãƒã‚¤ãƒŠãƒªãƒ¢ãƒ¼ãƒ‰ã«ã™ã‚‹ãŸã‚å…ˆé ­ã¸ç§»å‹•
    ado.Type = adTypeBinary;
    ado.Position = posSkipBOM; // BOM ã‚’é£›ã°ã™
    var list = ado.Read();
    ado.Close();

    // ãƒ•ã‚¡ã‚¤ãƒ«ã¸å‡ºåŠ›
    ado.Open();
    ado.Write(list);
    var file = Fso.BuildPath(PPx.Extract("%'temp'"), Fso.GetTempName());
    ado.SaveToFile(file, adSaveCreateOverWrite);
    ado.Close();
    return file;
}
```

