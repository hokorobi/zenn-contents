---
title: "CtrlP ã®çµæœã‚’åŠ å·¥ã—ã¦æŒ¿å…¥"
emoji: "ğŸ—‚"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Vim"]
published: true
---

[Shougo/ddu.vim](https://github.com/Shougo/ddu.vim) ã®ä½¿ã„æ–¹ã‚’èª¿ã¹ã¦ã„ãŸã‚‰ [ctrlpvim/ctrlp.vim](https://github.com/ctrlpvim/ctrlp.vim) ã‚‚ä½¿ã„ã“ãªã›ã¦ã„ãªã„ã“ã¨ãŒåˆ†ã‹ã£ã¦ã€ã‚€ã—ã‚ CtrlP ã®è¨­å®šãŒæ—ã£ã¦ã—ã¾ã£ãŸã€‚ãã®æˆæœã®ä¸€ã¤ã€‚
ã“ã†ã„ã†æƒ…å ±ãŒã‚ã‚“ã¾ã‚Šè¦‹ã¤ã‹ã‚‰ãªã„ã®ã§ã€ã‚‚ã—ã‹ã—ãŸã‚‰æ¨™æº–æ©Ÿèƒ½ã§ã§ãã‚‹ã®ã‹ã‚‚ã—ã‚Œãªã„ã€‚

`g:ctrlp_open_func` ã‚’è¨­å®šã™ã‚‹ã¨ã€ CtrlP ã®å®Ÿè¡Œå¾Œã«ãã®çµæœã‚’ä½¿ã£ã¦å®Ÿè¡Œã™ã‚‹é–¢æ•°ã‚’è¨­å®šã§ãã‚‹ã€‚
`vimrc#CtrlPOpenfunc` ã§å®Ÿè¡Œã™ã‚‹ CtrlP ã®ã‚³ãƒãƒ³ãƒ‰ã€ `g:ctrlp_open_func` ã«è¨­å®šã™ã‚‹é–¢æ•°ã€CtrlP ã®çµæœã®å‰å¾Œã«è¿½åŠ ã™ã‚‹æ–‡å­—åˆ—ã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ã—ãŸã€‚
`vimrc#CtrlPPasteFunc` ãŒæŒ¿å…¥ã™ã‚‹å®Ÿä½“ã®é–¢æ•°ã€‚
ä»¥ä¸‹ã‚’æ›¸ã„ã¦ `call execute('call vimrc#CtrlPOpenfunc("CtrlP", "vimrc#CtrlPPasteFunc", ".. image:: ")')` ã¨å®Ÿè¡Œã—ã¦ã‚„ã‚‹ã¨ CtrlP ã§é¸æŠã—ãŸç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã§ `.. image:: path/to/image` (Sphinx ã§ã®ç”»åƒã®è¨˜æ³•) ãªã©ã¨æŒ¿å…¥ã§ãã‚‹ã€‚

```vim: ~/vimfiles/autoload/vimrc.vim
" CtrlP ã§é¸æŠã—ãŸå†…å®¹ã‚’åŠ å·¥ã—ã¦ãƒãƒƒãƒ•ã‚¡ã«æŒ¿å…¥
function! vimrc#CtrlPPasteFunc(action, line) abort
  call ctrlp#exit()

  let backregz = getreg('z')
  call setreg('z', join([s:ctrlp_affix[0], a:line, s:ctrlp_affix[1]], ''))
  noautocmd normal! "zp
  call setreg('z', backregz)
  let g:ctrlp_open_func = {}
endfunction
function! vimrc#CtrlPOpenfunc(ctrlp, openfunc, prefix='', suffix='') abort
  if exists(":" .. a:ctrlp) != 2
    echohl WarningMsg | echomsg a:ctrlp .. ": å­˜åœ¨ã—ãªã„ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚" | echohl None
    return
  endif
  if exists("?" .. a:openfunc)
    echohl WarningMsg | echomsg a:openfunc .. ": å­˜åœ¨ã—ãªã„é–¢æ•°ã§ã™ã€‚" | echohl None
    return
  endif

  let s:ctrlp_affix = [a:prefix, a:suffix]
  let g:ctrlp_open_func = #{ files: a:openfunc }
  execute a:ctrlp
endfunction
```

