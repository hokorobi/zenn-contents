---
title: "Vim で IME をいい感じに使う"
emoji: "😀"
type: "tech"
topics: [Vim]
published: true
---
## 概要

Vim で期待しない IME のオン、オフを避けるための設定。
[vim-jp Slack](https://vim-jp.org/docs/chat.html) で質問して、現状このようになった。

## 履歴
- 2025-08-16
  - [Qiita の記事](https://qiita.com/hokorobi/items/824f3b2b752e6e8532cf) を Zenn で更新
  - インサートモードから `<C-c>` で抜けると `InsertLeave` が発火しないということなので `ModeChanged` を使うように変更。

## 環境

* Vim: [gvim 9.1.1634](https://github.com/vim/vim-win32-installer/releases/tag/v9.1.1634)
* Windows 11 24H2

## 設定

[動作](#動作) になるような設定を vimrc へ記載。

```vim
" インサートモードから抜けるときにIMEの状態を保持して、IMEはオフ
let s:lastiminsert = 0
autocmd vimrc ModeChanged i*:* let s:lastiminsert = &iminsert | setlocal iminsert=0
" 置換モードから抜けるときはIMEの状態を保持しない。
autocmd vimrc ModeChanged R*:* setlocal iminsert=0
" インサートモードに入るときにIMEの状態を反映
autocmd vimrc ModeChanged *:i* let &l:iminsert = s:lastiminsert
```

## 動作

```
凡例：
- IME ON：背景色 Lime
- ポイントの状態：文字色 赤
```

1. IME がオンの状態の挿入モードからノーマルモードに戻って、再度挿入モードに入ったら IME はオンのまま

    ![](/images/qiita-20200603-824f3b2b752e6e8532cf_01.png)


2. IME がオンの状態の挿入モードで改行しても IME オンのまま

    ![](/images/qiita-20200603-824f3b2b752e6e8532cf_02.png)
    ![](/images/qiita-20200603-824f3b2b752e6e8532cf_03.png)


3. 1 文字置換、置換モードに入ったら IME はオフ

    ![](/images/qiita-20200603-824f3b2b752e6e8532cf_04.png)
    ![](/images/qiita-20200603-824f3b2b752e6e8532cf_05.png)


4. コマンドラインモードに入ったら IME はオフ

    ![](/images/qiita-20200603-824f3b2b752e6e8532cf_06.png)

