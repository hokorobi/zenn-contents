---
title: "vimcomplete ã‚’ä½¿ã„å§‹ã‚ãŸ"
emoji: "ğŸ¦”"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Vim"]
published: true
---

Vim ã®è£œå®Œãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ [Shougo/ddc.vim](https://github.com/Shougo/ddc.vim) ã‚’ä½¿ã£ã¦ã„ãŸã‘ã‚Œã©ã€deno ã‚’ä½¿ã‚ãªãã¦æ¯”è¼ƒçš„é«˜é€Ÿãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è©¦ã—ãŸã„ãªã¨æ€ã£ãŸã®ã§ [girishji/vimcomplete](https://github.com/girishji/vimcomplete) ã‚’é¸æŠã€‚<br>
ï¼ˆddc.vim ã‚’ä½¿ã†å‰ã«ã¯ [prabirshrestha/asyncomplete.vim](https://github.com/prabirshrestha/asyncomplete.vim) ã‚’ä½¿ã£ã¦ã¾ã—ãŸã€‚ï¼‰<br>
å…¨ç„¶ç…®è©°ã‚åˆ‡ã‚Œã¦ã„ãªã„ã‘ã©ã€vimcomplete ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å°‘ãªãã†ãªã®ã§ã¨ã‚Šã‚ãˆãšå…¬é–‹ã—ã¡ã‚ƒã†ã€‚<br>
ä¸€å¿œ [Meguro.vim #27](https://megurovim.connpass.com/event/338986/) ã®æˆæœã‹ãªã€‚[ã‚¢ã‚«ãƒ„ã‚­](https://aktsk.jp) ã•ã‚“ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
ã¨ã‚Šã‚ãˆãšè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã€‚<br>
ç’°å¢ƒã«ã‚ˆã£ã¦ [Shougo/dein.vim](https://github.com/Shougo/dein.vim) ã¨ [Shougo/dpp.vim](https://github.com/Shougo/dpp.vim) ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ä½¿ã£ã¦ã„ã‚‹ã®ã§ã‚­ãƒ¡ãƒ©ãªçŠ¶æ…‹ã€‚

```toml: vimcomplete.toml
[[plugins]]
repo = 'girishji/vimcomplete'
hooks_file = '~/vimfiles/rc/dein/vimcomplete.vim'
merged = false
extAttrs = { installerFrozen = true }

[[plugins]]
repo = 'hrsh7th/vim-vsnip'
on_event = 'InsertEnter'
hooks_file = '~/vimfiles/rc/dein/vsnip.vim'

[[multiple_plugins]]
plugins = ['vimcomplete', 'vim-vsnip']
hook_source = '''
imap <silent><expr> <C-l>
      \ pumvisible() ?
      \   vsnip#expandable() ? '<Plug>(vsnip-expand)' :
      \   '' :
      \ vsnip#jumpable(1) ? '<Plug>(vsnip-jump-next)' :
      \ ''
'''
[[multiple_hooks]]
plugins = ['vimcomplete', 'vim-vsnip']
hook_source = '''
imap <silent><expr> <C-l>
      \ pumvisible() ?
      \   vsnip#expandable() ? '<Plug>(vsnip-expand)' :
      \   '' :
      \ vsnip#jumpable(1) ? '<Plug>(vsnip-jump-next)' :
      \ ''
'''

[[plugins]]
repo = 'rafamadriz/friendly-snippets'
merged = false
rtp = ''

[[plugins]]
repo = 'hrsh7th/vim-vsnip-integ'
on_source = 'vim-vsnip'

[[plugins]]
repo = 'yegappan/lsp'
hooks_file = '~/vimfiles/rc/dein/lsp.vim'
```

```vim: vimcomplete.vim
" hook_add {{{
let g:vimcomplete_enable_by_default = v:false
let g:vimcomplete_do_mapping = v:false

let s:options = #{
      \ completor: #{
      \   shuffleEqualPriority: v:true,
      \   triggerWordLen: 2,
      \   showCmpSource: v:false,
      \ },
      \ buffer: #{
      \   enable: v:true,
      \   priority: 10,
      \   urlComplete: v:true,
      \   envComplete: v:true,
      \   filetypes: ['autohotkey', 'cfg', 'gitcommit', 'javascript', 'markdown', 'plantuml', 'rst', 'snippet', 'python', 'toml', 'vim', 'xsl'],
      \ },
      \ dictionary: #{
      \   enable: v:true,
      \   priority: 11,
      \   matcher: 'ignorecase',
      \   properties: #{
      \     autohotkey: #{
      \       sortedDict: v:false,
      \       onlyWords: v:true,
      \     },
      \     plantuml: #{
      \       sortedDict: v:false,
      \       onlyWords: v:true,
      \     },
      \   },
      \   filetypes: ['autohotkey', 'plantuml'],
      \ },
      \ lsp: #{
      \   enable: v:true,
      \   priority: 10,
      \   maxCount: 5,
      \   filetypes: ['go', 'python', 'toml', 'typescript'],
      \ },
      \ omnifunc: #{
      \   enable: v:false,
      \   priority: 8,
      \   filetypes: ['plantuml'],
      \ },
      \ vsnip: #{
      \   enable: v:true,
      \   priority: 11,
      \   filetypes: ['go', 'plantuml', 'rst', 'vim'],
      \ },
      \ vimscript: #{
      \   enable: v:true,
      \   priority: 9,
      \ },
      \}

autocmd vimrc VimEnter * call g:VimCompleteOptionsSet(s:options)
autocmd vimrc VimEnter * VimCompleteEnable autohotkey cfg gitcommit go javascript markdown plantuml python rst snippet toml typescript vim xsl
" }}}
" autohotkey {{{
setlocal dictionary=~/vimfiles/rc/ddc/autohotkey.txt
" }}}
" plantuml {{{
setlocal dictionary=~/vimfiles/rc/ddc/plantuml.txt
" }}}
```

```vim: vsnip.vim
" hook_source {{{
imap <silent><expr> <Tab>
      \ pumvisible() ? '<Down>' :
      \ vsnip#jumpable(1)  ? '<Plug>(vsnip-jump-next)' :
      \ '<Tab>'
smap <silent><expr> <Tab>  vsnip#jumpable(1)  ? '<Plug>(vsnip-jump-next)' : '<Tab>'
imap <silent><expr> <S-Tab>
      \ pumvisible() ? '<Up>' :
      \ vsnip#jumpable(-1)  ? '<Plug>(vsnip-jump-prev)' :
      \ '<C-h>'
smap <expr> <S-Tab> vsnip#jumpable(-1) ? '<Plug>(vsnip-jump-prev)' : '<S-Tab>'
imap <silent><expr> <C-j>
      \ pumvisible() ? '<C-n>' :
      \ '<C-j>'
imap <silent> <C-n> <Down>
imap <silent><expr> <C-k>
      \ pumvisible() ? '<C-p>' :
      \ '<Cmd>normal! D<CR>'
imap <silent> <C-p> <Up>

let g:vsnip_snippet_dir = expand('~/vimfiles/rc/vsnip')
" }}}
```

```vim: lsp.vim
" hook_add {{{
function s:lspSet() abort
  let s:lspOpts = #{autoComplete: v:false}
  call LspOptionsSet(s:lspOpts)

  let s:lspServers = [
        \ #{name: 'deno',
        \   filetype: ['typescript'],
        \   path: 'deno',
        \   args: ['lsp'],
        \ },
        \ #{name: 'gopls',
        \   filetype: 'go',
        \   path: fnamemodify('~/_vim/lspservers/gopls/gopls.exe', ':p')->substitute('\', '/', 'g'),
        \   args: ['serve'],
        \   syncInit: v:true,
        \ },
        \ #{name: 'taplo',
        \   filetype: 'toml',
        \   path: 'taplo',
        \   args: ['lsp', 'stdio'],
        \ },
        \]
  call LspAddServer(s:lspServers)
endfunction
autocmd vimrc User LspSetup call s:lspSet()

function s:lspKeymap() abort
  nnoremap <buffer> <Space>al <Cmd>LspDiagShow<CR>
  nnoremap <buffer> K <Cmd>LspHover<CR>
  nnoremap <buffer> gd <Cmd>LspGotoDefinition<CR>
  nnoremap <buffer> <C-]> <Cmd>LspGotoDefinition<CR>
  nnoremap <buffer> <Space>ar <Cmd>LspRename<CR>
  nnoremap <buffer> <Space>aR <Cmd>LspReferences<CR>

  " submode
  call submode#enter_with('lsp', 'n', 'br', '<Space>aj', '<Cmd>LspDiagNext<CR>')
  call submode#enter_with('lsp', 'n', 'br', '<Space>an', '<Cmd>LspDiagNext<CR>')
  call submode#enter_with('lsp', 'n', 'br', '<Space>ak', '<Cmd>LspDiagPrev<CR>')
  call submode#enter_with('lsp', 'n', 'br', '<Space>ap', '<Cmd>LspDiagPrev<CR>')
  call submode#map('lsp', 'n', 'brs', 'j', '<Cmd>LspDiagNext<CR>')
  call submode#map('lsp', 'n', 'brs', 'n', '<Cmd>LspDiagNext<CR>')
  call submode#map('lsp', 'n', 'brs', 'k', '<Cmd>LspDiagPrev<CR>')
  call submode#map('lsp', 'n', 'brs', 'p', '<Cmd>LspDiagPrev<CR>')
endfunction
autocmd vimrc User LspAttached call s:lspKeymap()
" }}}
```

## vimcomplete ã‚’ä½¿ã†ã«ã‚ãŸã£ã¦

* [prabirshrestha/vim-lsp](https://github.com/prabirshrestha/vim-lsp) ã‹ã‚‰ [yegappan/lsp](https://github.com/yegappan/lsp) ã«å¤‰æ›´ã€‚vim-lsp ã®æ–¹ãŒå¤šæ©Ÿèƒ½ãªã®ã‹ãªï¼Ÿã€€ã‚ˆãã‚ã‹ã£ã¦ãªã„ã€‚
* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚­ãƒ¼ãƒãƒƒãƒ—ã‚’ç„¡åŠ¹ã«ã§ããªã‹ã£ãŸã®ã§ PR [PR1](https://github.com/girishji/vimcomplete/pull/87), [PR2](https://github.com/girishji/vimcomplete/pull/88) ï¼ˆãã‚Œãã‚ŒãƒŸã‚¹ã£ã¦ã‚‹ã‘ã©ï¼‰
* postfixHighlight ã‚’ä½¿ãŠã†ã¨æ€ã£ã¦ã„ã‚‹ã‘ã©ã‚­ãƒ¼ãƒãƒƒãƒ—ã‚’ã©ã†ã«ã‹ã—ãªã„ã¨ã„ã‘ãªã„ã®ã§ã€ã¾ã ä½¿ã£ã¦ã„ãªã„ã€‚
* friendly-snippets ã¯ã¨ã‚Šã‚ãˆãšå…¥ã‚Œã¦ã‚‹ã ã‘ã®çŠ¶æ…‹ã€‚
* vimcomplete ã¯ã¾ã ã¾ã æ‰‹ã‚’å…¥ã‚Œã‚‹ä½™åœ°ãŒã‚ã‚‹ã¨æ€ã†ã®ã§ã€æœ‰è­˜è€…ã«ã‚‚ä½¿ã£ã¦ã¿ã¦ã‚‚ã‚‰ã£ã¦ PR ã‚’é€ã£ã¦ã‚‚ã‚‰ã„ãŸã„ãªã€‚
