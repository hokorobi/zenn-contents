---
title: "Windows ã§ Vim ã‚’ä½¿ã£ãŸ fuzzy find ãªå®šå‹æ–‡ã‚³ãƒ”ãƒ¼"
emoji: "ğŸ˜"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Vim"]
published: false
---

å®šå‹æ–‡ã‚’è²¼ã‚Šä»˜ã‘ã‚‹å°‚ç”¨ã®ã‚½ãƒ•ãƒˆã‚’ä½¿ã†ã¨æ¥½ãªæ°—ã‚‚ã™ã‚‹ã‘ã© Vim ã§ã§ããã†ã ãªã¨æ€ã„ã¤ãŸã„ã®ã§ã‚„ã£ã¦ã¿ã¾ã—ãŸã€‚

ä¸‹ã®ã‚ˆã†ãªã“ã¨ãŒã‚ã£ãŸã®ã§ã€‚
- MS-IME ã®è¾æ›¸ã ã¨é•·ã•ã®åˆ¶é™ã«ã²ã£ã‹ã‹ã£ã¦ã—ã¾ã£ãŸã€‚
- ä¼šç¤¾ã® PC ã«æ–°ã—ã„ã‚½ãƒ•ãƒˆã‚’å…¥ã‚Œã‚‹ã®ãŒé¢å€’ã€‚

è©¦ã—ã¦ã„ã¦ã€ã“ã“ã‚‰è¾ºã‚‚è‰¯ã„ã¨ã“ã‚ã ãªã¨æ€ã£ãŸã¨ã“ã‚ã€‚
- é–¢æ•°ã‚’æ›¸ã„ã¦ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã®ä¸­èº«ã®ç·¨é›†ãŒã§ãã‚‹ã€‚
  è¡Œé ­ã«æ–‡å­—åˆ—ã‚’è¿½åŠ ã™ã‚‹ `AppendQuote()` ã‚’æ›¸ã„ã¦ã¿ã¾ã—ãŸã€‚
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚ã‚‹ã€‚
  `ReadfileCopy()` ã‚’æ›¸ã„ã¦ã¿ã¾ã—ãŸã€‚

## ä½¿ç”¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

- [ctrlpvim/ctrlp.vim](https://github.com/ctrlpvim/ctrlp.vim)
- [mattn/ctrlp-matchfuzzy](https://github.com/mattn/ctrlp-matchfuzzy)
- [mattn/ctrlp-launcher](https://github.com/mattn/ctrlp-launcher)
- [rhysd/vim-color-spring-night](https://github.com/rhysd/vim-color-spring-night) å¥½ã¿ã® colorscheme ã¨ã—ã¦

## å†ç¾æ‰‹é †

- ä¸‹ã® `vimrcLauncher` ã‚’ `C:\Users\username\vimfiles` ã«ä¿å­˜ã€‚
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ç”¨æ„ã€‚

    - ä½¿ç”¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ `C:\Users\username\_vim\dein\repos\github.com` ã« `ä½œè€…åã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª\ãƒªãƒã‚¸ãƒˆãƒªåã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª` ã§ç”¨æ„ã€‚
      é©å®œ `vimrcLauncher` ã® `s:reposPath`, `s:reposDirs` ã‚’å¤‰æ›´ã€‚

- ã‚³ãƒ”ãƒ¼ç”¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã€‚

    - `C:\Users\username\_vim\` ã« `.ctrlp-launcher-copy` ã‚’ä½œæˆã€‚
      é©å®œ `vimrcLauncher` ã® `g:ctrlp_launcher_file` ã‚’å¤‰æ›´ã€‚
    - `æ¤œç´¢å¯¾è±¡ã®æ–‡å­—åˆ—` ã¨ `å®Ÿè¡Œã™ã‚‹å‡¦ç†` ã‚’ `ã‚¿ãƒ–` ã§ç¹‹ã’ã¦æ›¸ãè¾¼ã¿
      ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã‚³ãƒ”ãƒ¼ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ `Copy` ã‚’ç”¨æ„ã—ã¦ã„ã‚‹ã®ã§ã€ãã®å¾Œã‚ã«ã‚³ãƒ”ãƒ¼ã—ãŸã„æ–‡å­—åˆ—ã‚’æ›¸ãã€‚

        ```txt: .ctrlp-launcher-copy
        mail	Copy hogefuga@hogemai.com
        append >	call AppendQuote('>')
        hosts	call ReadfileCopy('C:\WINDOWS\System32\drivers\etc\hosts')
        ```

- `C:\path\to\gvim.exe -N -U NONE -i NONE -u ~/vimfiles/vimrcLauncher -c "CtrlPLauncher copy"` ã®å®Ÿè¡Œã§ã‚·ãƒ³ãƒ—ãƒ«ãª gVim ãŒèµ·å‹•ã—ã¦ `CtrlPLauncher copy` ã‚’å®Ÿè¡Œã€‚

![èµ·å‹•æ™‚ã®ç”»é¢](https://storage.googleapis.com/zenn-user-upload/7eb3907a842a-20250202.png)

## å·¥å¤«ã—ãŸã¨ã“ã‚

- `<ESC>` ã§ Vim ã‚’çµ‚äº†ã§ãã‚‹ã‚ˆã†ã«ã€‚
  `<ESC>` æŠ¼ä¸‹å¾Œã€ 0.1 ç§’å¾Œã« `CursorHold` ãŒç™ºç«ã—ã¦ `:quit` ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚
- gVim ã®èµ·å‹•ã‚’é«˜é€ŸåŒ–ã€‚
  æ™®æ®µ [Shougo/dpp.vim](https://github.com/Shougo/dpp.vim) ã§é ‘å¼µã£ã¦ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®é…å»¶èª­ã¿è¾¼ã¿ã‚’ã™ã‚‹ã“ã¨ã§ 0.3 ç§’ã‚’åˆ‡ã‚‹ãã‚‰ã„ã®èµ·å‹•é€Ÿåº¦ã ã‘ã©ã€ã“ã‚Œã¯ 0.1 ç§’ã‚’åˆ‡ã‚‹ã€‚

    - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®èª­ã¿è¾¼ã¿ã‚’åœæ­¢
    - ãã®ã»ã‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚‚åœæ­¢

      - defaults.vim
      - filetypes.vim
      - indent.vim
      - syncolor.vim

- è¦‹ãŸç›®ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«

    - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³éè¡¨ç¤º

      - CtrlP ã‚’èµ·å‹•ã™ã‚‹ã¨ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒåˆ†å‰²ã•ã‚Œã‚‹ã®ã§ã€ãã®æ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³ã‚‚æ¶ˆãˆã‚‹ã‚ˆã†ã« `StatusLineNC` ã‚’ `Comment` ã¸

    - ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼éè¡¨ç¤º
    - ã‚¿ã‚¤ãƒˆãƒ«ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«
    - ãƒ¡ãƒ‹ãƒ¥ãƒ¼éè¡¨ç¤º
    - ãƒ•ã‚©ãƒ³ãƒˆã¯å¤§ãç›®

- ãªã‚‹ã¹ãã‚´ãƒŸã‚’æ®‹ã•ãªã„

    - viminfo ã®èª­ã¿æ›¸ãã‚’åœæ­¢
    - CtrlP ã®å±¥æ­´ã‚’ä¿å­˜ã—ãªã„

## ãƒ•ã‚¡ã‚¤ãƒ«

```vim: vimrcLauncher
" gvim -N -U NONE -i NONE -u ~/vimfiles/vimrcLauncher -c "CtrlPLauncher copy"
" benchmark
" gvim -N -U NONE -i NONE -u ~/vimfiles/vimrcLauncher -c "CtrlPLauncher copy" --startuptime vimrcLauncher.log
scriptversion 3
set encoding=utf-8
scriptencoding utf-8
" encoding è¨­å®šã§èµ·å‹•ãŒ 0.03s é…ããªã‚‹ï¼Ÿèª¤å·®ï¼Ÿ

let s:reposPath = expand('~\_vim\dein\repos\github.com\')
let s:reposDirs = [
     \ 'ctrlpvim\ctrlp.vim',
     \ 'mattn\ctrlp-launcher',
     \ 'mattn\ctrlp-matchfuzzy',
     \ 'rhysd\vim-color-spring-night',
     \]
" ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« .ctrlp-launcher-copy ã‚’ä½œæˆã—ã¦ãŠãã€‚
let g:ctrlp_launcher_file = '~/_vim/.ctrlp-launcher'
" æ™®æ®µ CtrlP ã‚’ä½¿ã£ã¦ã„ã‚‹ãªã‚‰åˆ¥ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®š
let g:ctrlp_cache_dir = '~/_vim/.ctrlpLauncher'


" ä¸è¦ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã€è¨­å®šã‚’èª­ã¿è¾¼ã¾ãªã„
" plugin
let g:loaded_getscriptPlugin   = 1
let g:loaded_gzip              = 1
let g:loaded_logiPat           = 1
let g:loaded_manpager_plugin   = 1
let g:loaded_matchparen        = 1
let g:loaded_netrw             = 1
let g:loaded_netrwPlugin       = 1
let g:loaded_netrwSettings     = 1
let g:loaded_netrwFileHandlers = 1
let g:loaded_rrhelper          = 1
let g:loaded_spellfile_plugin  = 1
let g:loaded_tar               = 1
let g:loaded_tarPlugin         = 1
let g:loaded_2html_plugin      = 1
let g:loaded_tutor_mode_plugin = 1
let g:loaded_vimball           = 1
let g:loaded_vimballPlugin     = 1
let g:loaded_zip               = 1
let g:loaded_zipPlugin         = 1

" defaults.vim
let g:skip_defaults_vim        = 1
" filetypes.vim
let g:did_load_filetypes       = 1
" indent.vim
let g:did_indent_on            = 1
" syncolor.vim
let g:syntax_cmd               = 'disable'

" viminfo ã¯èª­ã¿æ›¸ãã—ãªã„
set viminfo=

" simple window
let g:did_install_default_menus = 1
let g:did_install_syntax_menu = 1
" guioptions-=r å³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚’æ¶ˆã™ã¨èµ·å‹•ãŒ 0.03s ã»ã©é…ããªã‚‹ï¼Ÿã€€èª¤å·®ï¼Ÿ
set guioptions+=M guioptions-=m guioptions-=e guioptions-=T guioptions+=! guioptions-=r
" æœ«å°¾ã«åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚ã‚Šã€‚~ ã‚’æ¶ˆã™ãŸã‚ã€‚
set fillchars=eob:\ 
set notitle

" remove statusline
" æœ«å°¾ã«åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚ã‚Šã€‚ãƒãƒƒãƒ•ã‚¡åã‚’æ¶ˆã™ãŸã‚
set statusline=\ 
set laststatus=0
autocmd ColorScheme * :highlight! link StatusLineNC Comment

" set plugins
for s:dir in s:reposDirs
  execute($'set runtimepath+={s:reposPath}{s:dir}')
endfor

" CtrlP
let g:ctrlp_max_history = 0
let g:ctrlp_match_window = 'bottom,order:btt,min:21,max:21,results:0'
let g:ctrlp_regexp = 0
" ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚­ãƒ¼ãƒãƒƒãƒ—ã‚’åˆ¥ã®æ“ä½œã«ä½¿ã„ãŸã„å ´åˆã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚­ãƒ¼ãƒãƒƒãƒ—ã‚‚å¤‰æ›´ã™ã‚‹
let g:ctrlp_prompt_mappings = {
      \ 'PrtBS()'              : ['<bs>', '<c-]>', '<c-h>'],
      \ 'ToggleType(1)'        : ['<c-up>'],
      \ 'ToggleType(-1)'       : ['<c-down>'],
      \ 'PrtCurLeft()'         : ['<c-b>', '<left>', '<c-^>'],
      \ 'PrtCurRight()'        : ['<c-f>', '<c-l>', '<right>'],
      \ 'AcceptSelection("e")' : ['<cr>', '<2-LeftMouse>', '<m-m>'],
      \ 'PrtHistory(-1)'       : [],
      \ 'PrtSelectMove("j")'   : ['<c-j>', '<down>', '<m-j>', '<c-n>'],
      \ 'PrtHistory(1)'        : [],
      \ 'PrtSelectMove("k")'   : ['<c-k>', '<up>', '<m-k>', '<c-p>'],
      \ 'AcceptSelection("v")' : [],
      \ 'PrtInsert("c")'       : ['<c-v>', '<MiddleMouse>', '<insert>'],
      \ 'ToggleByFname()'      : [],
      \ 'PrtDelete()'          : ['<c-d>', '<del>'],
      \ 'PrtDeleteEnt()'       : ['<F7>', '<c-w>'],
      \ 'PrtDeleteWord()'      : ['<c-q>'],
      \ }

" ctrlp-matchfuzzy
let g:ctrlp_match_func = #{match: 'ctrlp_matchfuzzy#matcher'}

" spring-night
let g:spring_night_kill_italic = 1
let g:spring_night_kill_bold = 1

filetype plugin indent on
syntax on

" colorscheme ã¯èµ·å‹•æ™‚é–“ã«ã»ã¼å½±éŸ¿ãªã„
colorscheme spring-night

set guifont=ï¼­ï¼³_ã‚´ã‚·ãƒƒã‚¯:h18

function! Copy(s) abort
  call setreg("*", a:s)
  quit
endfunction
command! -nargs=1 Copy call Copy(<q-args>)

function AppendQuote(quote) abort
  call getreg("*", 1, v:true)
        \ ->map({_, v -> $'{a:quote} {v}'})
        \ ->setreg("*")
  quit
endfunction

function ReadfileCopy(file) abort
  call readfile(a:file)->setreg("*")
  quit
endfunction

" <ESC> ã§Vimã‚’çµ‚äº†
set updatetime=100
autocmd CursorHold <buffer> :quit
```

